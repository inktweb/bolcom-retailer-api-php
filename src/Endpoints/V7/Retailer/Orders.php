<?php

/**
 * This file is auto-generated by
 * Inktweb\Bolcom\RetailerApi\Development\Generator\Endpoints
 */

namespace Inktweb\Bolcom\RetailerApi\Endpoints\V7\Retailer;

use GuzzleHttp\Exception\GuzzleException;
use Inktweb\Bolcom\RetailerApi\Contracts\Endpoint;
use Inktweb\Bolcom\RetailerApi\Enums\Endpoints\V7\Retailer\Orders\FulfilmentMethod;
use Inktweb\Bolcom\RetailerApi\Enums\Endpoints\V7\Retailer\Orders\Status;
use Inktweb\Bolcom\RetailerApi\Exceptions\ApiException;
use Inktweb\Bolcom\RetailerApi\Exceptions\Enum\UnknownCollectionFormatException;
use Inktweb\Bolcom\RetailerApi\Exceptions\UnexpectedResponseContentTypeException;
use Inktweb\Bolcom\RetailerApi\Models\V7\Retailer\ContainerForTheOrderItemsThatHaveToBeCancelled;
use Inktweb\Bolcom\RetailerApi\Models\V7\Retailer\Order;
use Inktweb\Bolcom\RetailerApi\Models\V7\Retailer\Problem;
use Inktweb\Bolcom\RetailerApi\Models\V7\Retailer\ProcessStatus;
use Inktweb\Bolcom\RetailerApi\Models\V7\Retailer\ReducedOrders;
use Inktweb\Bolcom\RetailerApi\Models\V7\Retailer\ShipmentRequest;

final class Orders extends Endpoint
{
    /**
     * Get a list of orders.
     *
     * Gets a paginated list of all orders for a retailer.
     *
     * @throws ApiException
     * @throws GuzzleException
     * @throws UnexpectedResponseContentTypeException
     * @throws UnknownCollectionFormatException
     */
    public function getOrders(
        ?int $page = null,
        ?FulfilmentMethod $fulfilmentMethod = null,
        ?Status $status = null
    ): ReducedOrders {
        return ReducedOrders::fromArray(
            $this->request(
                'get',
                'orders',
                [],
                [
                'page' => $page,
                'fulfilment-method' => $fulfilmentMethod,
                'status' => $status,
                ],
                null,
                [
                'application/vnd.retailer.v7+json',
                ],
                [
                'application/vnd.retailer.v7+json',
                ],
                []
            )->getBody()->getJson()
        );
    }

    /**
     * Cancel an order item by an order item id.
     *
     * This endpoint can be used to either confirm a cancellation request by
     * the customer or to cancel an order item you yourself are unable to
     * fulfil.
     *
     * @throws ApiException
     * @throws GuzzleException
     * @throws UnexpectedResponseContentTypeException
     * @throws UnknownCollectionFormatException
     */
    public function cancelOrderItem(ContainerForTheOrderItemsThatHaveToBeCancelled $body): ProcessStatus
    {
        return ProcessStatus::fromArray(
            $this->request(
                'put',
                'orders/cancellation',
                [],
                [],
                $body,
                [
                'application/vnd.retailer.v7+json',
                ],
                [
                'application/vnd.retailer.v7+json',
                ],
                [
                400 => Problem::class,
                ]
            )->getBody()->getJson()
        );
    }

    /**
     * Ship order item.
     *
     * Ship a single order item within a customer order by providing shipping
     * information. If you purchased a shipping label you should add the
     * shippingLabelId to this message and leave the transport element empty.
     * If you will ship the item using your own transporter method you must
     * omit the shippingLabelId entirely and fill in the transport element
     * with the fields from GET shipping labels.
     *
     * @throws ApiException
     * @throws GuzzleException
     * @throws UnexpectedResponseContentTypeException
     * @throws UnknownCollectionFormatException
     */
    public function shipOrderItem(ShipmentRequest $body): ProcessStatus
    {
        return ProcessStatus::fromArray(
            $this->request(
                'put',
                'orders/shipment',
                [],
                [],
                $body,
                [
                'application/vnd.retailer.v7+json',
                ],
                [
                'application/vnd.retailer.v7+json',
                ],
                [
                400 => Problem::class,
                ]
            )->getBody()->getJson()
        );
    }

    /**
     * Get an order by order id.
     *
     * Gets an order by order id. The order can be partially shipped or
     * cancelled, and the message contains the quantity shipped or cancelled
     * items. The unitPrice takes account of volume discounts.
     *
     * @throws ApiException
     * @throws GuzzleException
     * @throws UnexpectedResponseContentTypeException
     * @throws UnknownCollectionFormatException
     */
    public function getOrder(string $orderId): Order
    {
        return Order::fromArray(
            $this->request(
                'get',
                'orders/{order-id}',
                [
                'order-id' => $orderId,
                ],
                [],
                null,
                [
                'application/vnd.retailer.v7+json',
                ],
                [
                'application/vnd.retailer.v7+json',
                ],
                [
                404 => Problem::class,
                ]
            )->getBody()->getJson()
        );
    }
}
