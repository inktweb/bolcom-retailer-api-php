<?php

/**
 * This file is auto-generated by
 * Inktweb\Bolcom\RetailerApi\Development\Generator\Endpoints
 */

namespace Inktweb\Bolcom\RetailerApi\Endpoints\V9\Retailer;

use GuzzleHttp\Exception\GuzzleException;
use Inktweb\Bolcom\RetailerApi\Contracts\Endpoint;
use Inktweb\Bolcom\RetailerApi\Enums\Endpoints\V9\Retailer\Returns\FulfilmentMethod;
use Inktweb\Bolcom\RetailerApi\Exceptions\ApiException;
use Inktweb\Bolcom\RetailerApi\Exceptions\Enum\UnknownCollectionFormatException;
use Inktweb\Bolcom\RetailerApi\Exceptions\UnexpectedResponseContentTypeException;
use Inktweb\Bolcom\RetailerApi\Models\V9\Retailer\CreateReturnRequest;
use Inktweb\Bolcom\RetailerApi\Models\V9\Retailer\Problem;
use Inktweb\Bolcom\RetailerApi\Models\V9\Retailer\ProcessStatus;
use Inktweb\Bolcom\RetailerApi\Models\V9\Retailer\ReturnMerchandise;
use Inktweb\Bolcom\RetailerApi\Models\V9\Retailer\ReturnRequest;
use Inktweb\Bolcom\RetailerApi\Models\V9\Retailer\ReturnsResponse;

final class Returns extends Endpoint
{
    /**
     * Get returns.
     *
     * Get a paginated list of multi-item returns. Handled returns are sorted
     * by date in descending order, while unhandled returns are sorted by
     * date in ascending order.
     *
     * @throws ApiException
     * @throws GuzzleException
     * @throws UnexpectedResponseContentTypeException
     * @throws UnknownCollectionFormatException
     */
    public function getReturns(
        ?int $page = null,
        ?bool $handled = null,
        ?FulfilmentMethod $fulfilmentMethod = null
    ): ReturnsResponse {
        return ReturnsResponse::fromArray(
            $this->request(
                'get',
                'returns',
                [],
                [
                'page' => $page,
                'handled' => $handled,
                'fulfilment-method' => $fulfilmentMethod,
                ],
                null,
                [
                'application/vnd.retailer.v9+json',
                ],
                [
                'application/vnd.retailer.v9+json',
                ],
                [
                400 => Problem::class,
                ]
            )->getBody()->getJson()
        );
    }

    /**
     * Create a return.
     *
     * Create a return, and automatically handle it with the provided
     * handling result. When successfully created, the resulting return id is
     * provided in the process status.
     *
     * @throws ApiException
     * @throws GuzzleException
     * @throws UnexpectedResponseContentTypeException
     * @throws UnknownCollectionFormatException
     */
    public function createReturn(CreateReturnRequest $body): ProcessStatus
    {
        return ProcessStatus::fromArray(
            $this->request(
                'post',
                'returns',
                [],
                [],
                $body,
                [
                'application/vnd.retailer.v9+json',
                ],
                [
                'application/vnd.retailer.v9+json',
                ],
                [
                400 => Problem::class,
                ]
            )->getBody()->getJson()
        );
    }

    /**
     * Get a return by return id.
     *
     * Retrieve a return based on the return id.
     *
     * @throws ApiException
     * @throws GuzzleException
     * @throws UnexpectedResponseContentTypeException
     * @throws UnknownCollectionFormatException
     */
    public function getReturn(string $returnId): ReturnMerchandise
    {
        return ReturnMerchandise::fromArray(
            $this->request(
                'get',
                'returns/{return-id}',
                [
                'return-id' => $returnId,
                ],
                [],
                null,
                [
                'application/vnd.retailer.v9+json',
                ],
                [
                'application/vnd.retailer.v9+json',
                ],
                [
                404 => Problem::class,
                ]
            )->getBody()->getJson()
        );
    }

    /**
     * Handle a return by rma id.
     *
     * Allows the user to handle a return. This can be to either handle an
     * open return, or change the handlingResult of an already handled
     * return. Please refer to the Returns documentation for further details.
     *
     * @throws ApiException
     * @throws GuzzleException
     * @throws UnexpectedResponseContentTypeException
     * @throws UnknownCollectionFormatException
     */
    public function handleReturn(int $rmaId, ReturnRequest $body): ProcessStatus
    {
        return ProcessStatus::fromArray(
            $this->request(
                'put',
                'returns/{rma-id}',
                [
                'rma-id' => $rmaId,
                ],
                [],
                $body,
                [
                'application/vnd.retailer.v9+json',
                ],
                [
                'application/vnd.retailer.v9+json',
                ],
                [
                400 => Problem::class,
                ]
            )->getBody()->getJson()
        );
    }
}
