<?php

/**
 * This file is auto-generated by
 * Inktweb\Bolcom\RetailerApi\Development\Generator\Endpoints
 */

namespace Inktweb\Bolcom\RetailerApi\Endpoints\V10\Retailer;

use GuzzleHttp\Exception\GuzzleException;
use Inktweb\Bolcom\RetailerApi\Contracts\Endpoint;
use Inktweb\Bolcom\RetailerApi\Enums\Endpoints\V10\Retailer\Shipments\FulfilmentMethod;
use Inktweb\Bolcom\RetailerApi\Enums\Endpoints\V10\Retailer\Shipments\State;
use Inktweb\Bolcom\RetailerApi\Exceptions\ApiException;
use Inktweb\Bolcom\RetailerApi\Exceptions\Enum\UnknownCollectionFormatException;
use Inktweb\Bolcom\RetailerApi\Exceptions\UnexpectedResponseContentTypeException;
use Inktweb\Bolcom\RetailerApi\Models\V10\Retailer\InvoiceRequestsResponse;
use Inktweb\Bolcom\RetailerApi\Models\V10\Retailer\Problem;
use Inktweb\Bolcom\RetailerApi\Models\V10\Retailer\ProcessStatus;
use Inktweb\Bolcom\RetailerApi\Models\V10\Retailer\Shipment;
use Inktweb\Bolcom\RetailerApi\Models\V10\Retailer\ShipmentsResponse;

final class Shipments extends Endpoint
{
    /**
     * Get shipment list.
     *
     * A paginated list to retrieve all your shipments up to 3 months old.
     * The shipments will be sorted by date in descending order.
     *
     * @throws ApiException
     * @throws GuzzleException
     * @throws UnexpectedResponseContentTypeException
     * @throws UnknownCollectionFormatException
     */
    public function getShipments(
        ?int $page = null,
        ?FulfilmentMethod $fulfilmentMethod = null,
        ?string $orderId = null
    ): ShipmentsResponse {
        return ShipmentsResponse::fromArray(
            $this->request(
                'get',
                'shipments',
                [],
                [
                'page' => $page,
                'fulfilment-method' => $fulfilmentMethod,
                'order-id' => $orderId,
                ],
                null,
                [
                'application/vnd.retailer.v10+json',
                ],
                [
                'application/vnd.retailer.v10+json',
                ],
                [
                400 => Problem::class,
                ]
            )->getBody()->getJson()
        );
    }

    /**
     * Create a shipment.
     *
     * Ship multiple single order items within a customer order by providing
     * shipping information. If you purchased a shipping label you should add
     * the shippingLabelId to this message and leave the transport element
     * empty. If you will ship the item using your own transporter method you
     * must omit the shippingLabelId entirely and fill in the transport
     * element with the fields from GET shipping labels.
     *
     * @throws ApiException
     * @throws GuzzleException
     * @throws UnexpectedResponseContentTypeException
     * @throws UnknownCollectionFormatException
     */
    public function createShipment(): ProcessStatus
    {
        return ProcessStatus::fromArray(
            $this->request(
                'post',
                'shipments',
                [],
                [],
                null,
                [
                'application/vnd.retailer.v10+json',
                ],
                [
                'application/vnd.retailer.v10+json',
                ],
                [
                400 => Problem::class,
                ]
            )->getBody()->getJson()
        );
    }

    /**
     * Get a list of invoice requests.
     *
     * Gets a list of paginated invoice requests initiated by customers.
     *
     * @throws ApiException
     * @throws GuzzleException
     * @throws UnexpectedResponseContentTypeException
     * @throws UnknownCollectionFormatException
     */
    public function getInvoiceRequests(
        ?string $shipmentId = null,
        ?int $page = null,
        ?State $state = null
    ): InvoiceRequestsResponse {
        return InvoiceRequestsResponse::fromArray(
            $this->request(
                'get',
                'shipments/invoices/requests',
                [],
                [
                'shipment-id' => $shipmentId,
                'page' => $page,
                'state' => $state,
                ],
                null,
                [
                'application/vnd.retailer.v10+json',
                ],
                [
                'application/vnd.retailer.v10+json',
                ],
                [
                400 => Problem::class,
                404 => Problem::class,
                ]
            )->getBody()->getJson()
        );
    }

    /**
     * Upload an invoice for shipment id.
     *
     * Uploads an invoice associated with shipment id.
     *
     * @throws ApiException
     * @throws GuzzleException
     * @throws UnexpectedResponseContentTypeException
     * @throws UnknownCollectionFormatException
     */
    public function uploadInvoice(string $shipmentId): ProcessStatus
    {
        return ProcessStatus::fromArray(
            $this->request(
                'post',
                'shipments/invoices/{shipment-id}',
                [
                'shipment-id' => $shipmentId,
                ],
                [],
                null,
                [
                'application/vnd.retailer.v10+json',
                ],
                [
                'application/vnd.retailer.v10+json',
                ],
                [
                400 => Problem::class,
                404 => Problem::class,
                415 => Problem::class,
                ]
            )->getBody()->getJson()
        );
    }

    /**
     * Get a shipment by shipment id.
     *
     * Retrieve a single shipment by its corresponding id.
     *
     * @throws ApiException
     * @throws GuzzleException
     * @throws UnexpectedResponseContentTypeException
     * @throws UnknownCollectionFormatException
     */
    public function getShipment(string $shipmentId): Shipment
    {
        return Shipment::fromArray(
            $this->request(
                'get',
                'shipments/{shipment-id}',
                [
                'shipment-id' => $shipmentId,
                ],
                [],
                null,
                [
                'application/vnd.retailer.v10+json',
                ],
                [
                'application/vnd.retailer.v10+json',
                ],
                [
                404 => Problem::class,
                ]
            )->getBody()->getJson()
        );
    }
}
