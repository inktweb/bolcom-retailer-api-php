<?php

/**
 * This file is auto-generated by
 * Inktweb\Bolcom\RetailerApi\Development\Generator\Endpoints
 */

namespace Inktweb\Bolcom\RetailerApi\Endpoints\V10\Retailer;

use GuzzleHttp\Exception\GuzzleException;
use Inktweb\Bolcom\RetailerApi\Contracts\Endpoint;
use Inktweb\Bolcom\RetailerApi\Enums\Endpoints\V10\Retailer\Commissions\Condition;
use Inktweb\Bolcom\RetailerApi\Exceptions\ApiException;
use Inktweb\Bolcom\RetailerApi\Exceptions\Enum\UnknownCollectionFormatException;
use Inktweb\Bolcom\RetailerApi\Exceptions\UnexpectedResponseContentTypeException;
use Inktweb\Bolcom\RetailerApi\Models\V10\Retailer\BulkCommissionResponse;
use Inktweb\Bolcom\RetailerApi\Models\V10\Retailer\Commission;
use Inktweb\Bolcom\RetailerApi\Models\V10\Retailer\Problem;

final class Commissions extends Endpoint
{
    /**
     * Get all commissions and reductions by EAN in bulk.
     *
     * Gets all commissions and possible reductions by EAN, price, and
     * optionally condition.
     *
     * @throws ApiException
     * @throws GuzzleException
     * @throws UnexpectedResponseContentTypeException
     * @throws UnknownCollectionFormatException
     */
    public function getCommissions(): BulkCommissionResponse
    {
        return BulkCommissionResponse::fromArray(
            $this->request(
                'post',
                'commission',
                [],
                [],
                null,
                [
                'application/vnd.retailer.v10+json',
                ],
                [
                'application/vnd.retailer.v10+json',
                ],
                [
                400 => Problem::class,
                404 => Problem::class,
                ]
            )->getBody()->getJson()
        );
    }

    /**
     * Get all commissions and reductions by EAN per single EAN.
     *
     * Commissions can be filtered by condition, which defaults to NEW. We
     * will calculate the commission amount from the EAN and price.
     *
     * @throws ApiException
     * @throws GuzzleException
     * @throws UnexpectedResponseContentTypeException
     * @throws UnknownCollectionFormatException
     */
    public function getCommission(string $ean, float $unitPrice, ?Condition $condition = null): Commission
    {
        return Commission::fromArray(
            $this->request(
                'get',
                'commission/{ean}',
                [
                'ean' => $ean,
                ],
                [
                'condition' => $condition,
                'unit-price' => $unitPrice,
                ],
                null,
                [
                'application/vnd.retailer.v10+json',
                ],
                [
                'application/vnd.retailer.v10+json',
                ],
                [
                400 => Problem::class,
                404 => Problem::class,
                ]
            )->getBody()->getJson()
        );
    }
}
